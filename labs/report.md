---
## Front matter
title: "Отчёт по лабораторной работе №9"
subtitle: "Управление SELinux"
author: "Агджабекова Эся Рустамовна"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с контекстом безопасности и политиками SELinux.

# Ход выполнения работы

## Управление режимами SELinux

1. Запущен терминал и получены права администратора с помощью команды su.  
   Проверена текущая информация о состоянии SELinux командой sestatus -v (см. рис. [@fig:001]).  

   ![Проверка текущего состояния SELinux](image/01.png){ #fig:001 width=70% }

2. Определено, что SELinux включён, политика безопасности установлена в режиме enforcing, а политика по умолчанию — targeted.  
   Это означает, что SELinux активно контролирует доступ процессов и применяет правила безопасности к целевым службам.

3. Для проверки текущего режима работы выполнена команда getenforce, показавшая значение Enforcing.  
   Режим изменён на Permissive командой setenforce 0, затем снова выполнена getenforce, подтвердившая переключение режима (см. рис. [@fig:002]).  

   ![Переключение режима SELinux в Permissive](image/02.png){ #fig:002 width=70% }

4. С помощью текстового редактора nano открыт и изменён файл /etc/sysconfig/selinux.  
   В параметре SELINUX установлено значение disabled.  
   После этого система была перезагружена (см. рис. [@fig:003]).  

   ![Отключение SELinux в конфигурационном файле](image/03.png){ #fig:003 width=70% }

5. После перезапуска системы снова получены права администратора и выполнена команда getenforce, показавшая, что SELinux теперь отключён.  
   Попытка переключить режим командой setenforce 1 завершилась сообщением, что SELinux отключён и изменить режим невозможно без перезагрузки (см. рис. [@fig:004]).  

   ![Попытка включить SELinux после отключения](image/04.png){ #fig:004 width=70% }

6. Для восстановления работы SELinux файл /etc/sysconfig/selinux снова отредактирован, установлено значение enforcing.  
   После сохранения изменений и перезагрузки система начала процесс relabeling — восстановление контекстов безопасности (см. рис. [@fig:005]).  

   ![Процесс relabeling при включении SELinux](image/05.png){ #fig:005 width=70% }

7. После повторной загрузки в терминале проверено состояние SELinux командой sestatus -v.  
   Система снова работает в режиме enforcing, что подтверждает успешное восстановление политики безопасности (см. рис. [@fig:006]).  

   ![Проверка состояния SELinux после восстановления](image/06.png){ #fig:006 width=70% }

## Использование restorecon для восстановления контекста безопасности

1. Получены права администратора. Проверен контекст безопасности файла /etc/hosts командой ls -Z, который имел тип net_conf_t.  
2. Файл /etc/hosts скопирован в домашний каталог, где его контекст изменился на admin_home_t.  
3. При перемещении файла обратно в каталог /etc контекст сохранился неверным (admin_home_t).  
4. Для восстановления корректного контекста выполнена команда restorecon -v /etc/hosts, после чего тип контекста вновь стал net_conf_t.  
5. Для массового восстановления меток безопасности создан пустой файл /.autorelabel, который инициирует полное перемаркирование при следующей загрузке (см. рис. [@fig:007]).  

   ![Восстановление контекста безопасности с помощью restorecon](image/07.png){ #fig:007 width=70% }

## Настройка контекста безопасности для нестандартного расположения файлов веб-сервера

1. Запущен терминал и получены права администратора. Установлены необходимые пакеты httpd и lynx.  
2. Создан каталог /web, предназначенный для размещения файлов веб-сервера, и внутри него создан файл index.html с содержимым «Welcome to my web server».  
3. В конфигурационном файле /etc/httpd/conf/httpd.conf закомментированы строки, указывающие на стандартный каталог /var/www/html, и добавлены новые параметры DocumentRoot "/web" и раздел Directory "/web" с разрешённым доступом ко всем пользователям (см. рис. [@fig:008]).  

   ![Изменение конфигурационного файла httpd.conf для новой директории](image/08.png){ #fig:008 width=70% }

4. После сохранения изменений веб-сервер запущен и добавлен в автозагрузку.  
   При обращении к серверу через браузер lynx по адресу http://localhost отображается стандартная страница Rocky Linux (см. рис. [@fig:009]).  

   ![Отображение стандартной тестовой страницы Apache](image/09.png){ #fig:009 width=70% }

5. Для корректной работы веб-сервера с новым каталогом применена новая метка контекста безопасности, после чего контексты восстановлены с помощью restorecon. Это обеспечило доступ службы httpd к файлам в каталоге /web (см. рис. [@fig:010]).  

   ![Применение меток безопасности для каталога /web](image/10.png){ #fig:010 width=70% }

6. После изменения контекста и перезапуска службы веб-сервера при повторном обращении через lynx отображается созданная страница с сообщением «Welcome to my web server» (см. рис. [@fig:011]).  

   ![Отображение пользовательской страницы веб-сервера](image/11.png){ #fig:011 width=70% }


## Работа с переключателями SELinux

1. Получены права администратора. Выполнена проверка состояния переключателей SELinux для службы ftp, выявлено, что переключатель ftpd_anon_write имеет значение off.  
2. Просмотрен список доступных переключателей и их описаний, относящихся к службе ftpd_anon.  
3. Для разрешения анонимной записи переключатель ftpd_anon_write был включён, а затем его состояние закреплено как постоянное.  
4. Повторная проверка показала, что переключатель ftpd_anon_write теперь включён (см. рис. [@fig:012]).  

   ![Настройка переключателя SELinux для службы FTP](image/12.png){ #fig:012 width=70% }

Переключатель ftpd_anon_write находится в состоянии on, что означает разрешение на запись для анонимных FTP-пользователей.

# Контрольные вопросы

1. **Вы хотите временно поставить SELinux в разрешающем режиме. Какую команду вы используете?**  
   Команда: `setenforce 0`.

2. **Вам нужен список всех доступных переключателей SELinux. Какую команду вы используете?**  
   Команда: `getsebool -a`.

3. **Каково имя пакета, который требуется установить для получения легко читаемых сообщений журнала SELinux в журнале аудита?**  
   Пакет: `setroubleshoot`.

4. **Какие команды вам нужно выполнить, чтобы применить тип контекста httpd_sys_content_t к каталогу /web?**  
   Команды:  
   `semanage fcontext -a -t httpd_sys_content_t "/web(/.*)?"`  
   `restorecon -R -v /web`.

5. **Какой файл вам нужно изменить, если вы хотите полностью отключить SELinux?**  
   Файл: `/etc/sysconfig/selinux`.

6. **Где SELinux регистрирует все свои сообщения?**  
   В журнале `/var/log/audit/audit.log`.

7. **Вы не знаете, какие типы контекстов доступны для службы ftp. Какая команда позволяет получить более конкретную информацию?**  
   Команда: `semanage fcontext -l | grep ftp`.

8. **Ваш сервис работает не так, как ожидалось, и вы хотите узнать, связано ли это с SELinux или чем-то ещё. Какой самый простой способ узнать?**  
   Временно перевести SELinux в разрешающий режим командой `setenforce 0` и проверить работу сервиса.

# Заключение

В ходе лабораторной работы были изучены основные принципы работы SELinux и его взаимодействие с системой безопасности Linux.  
В результате работы получены практические навыки администрирования и конфигурирования SELinux, необходимых для обеспечения безопасности и стабильности работы системы.
